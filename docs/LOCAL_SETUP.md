# <b style="color: lightgreen;">(UP-TO-DATE)</b> How to setup and run locally

## Prerequisites to run locally

| Software                 | Version |
| ------------------------ | ------- |
| **git**                  | 2.39.1  |
| **node**                 | 18.13.0 |
| **npm**                  | 9.3.1   |
| **nx**                   | 15.5.2  |
| **concurrently**         | 7.6.0   |
| **docker (mac/linux)**   | 20.10   |
| **docker desktop (win)** | 4.16    |

You can use the scripts in the [/prereq](./prereq) folder to verify and update the software.

> Note: The script only UPDATE the software and it requires it to be already installed on the system.

- **[linux.sh](./prereq/linux.sh)**: {+ Only apt-based Linux systems (i.e. Ubuntu) are supported. \`curl\` must be installed. Run as sudo. +}.
- **[mac.sh](./prereq/mac.sh)**: {+ \`brew\` must be installed. Run as sudo. +}.
- **[windows.bat](./prereq/windows.bat)**: {+ \`choco\` (Chocolatey) must be installed. +}.

---

## Setup locally

- Clone the repo
- (Optional) Run the appropriate script located in the [/prereq](./prereq) folder.
- If you don't run the prereq script, install the dependencies manually. From the root directory:

```bash
# Install npm dependencies
npm install

# Install global packages if not present
npm install -g nx@15.5.2
npm install -g concurrently@7.6.0
```

- Download the `api-to-s3_accessKeys.csv` from Discord (or ask a team member for it) and place it in the [/scripts](../scripts/) folder.
- From a bash environment (wsl2 or Git Bash), run the setup.sh script to generate the .env file for the backend.

```bash
# From the root directory

# Install npm dependencies and create .env file
./scripts/setup.sh

# Only create .env file
./scripts/setup.sh -s
```

> Note: The .env file cannot be manually created because fields in the file are generated by the script

- <b style="color: red;">(MACOS USERS ONLY) Manually change the api port number to 5050 in both .env files. Port 5000 is used by an internal service</b>

```bash
VITE_API_HOST=localhost:5050 # frontend
PORT=5050 # backend
```

### Run Both Frontend and Backend Services

- From the root directory of the project, run `npm run start:all`.

```bash
# From the root directory
npm run start:all
```

### Run Frontend Only

- From the root directory, navigate to the [/frontend](./frontend) folder run `npm start` to view the webapp on the browser.

```bash
# From the root directory
cd ./frontend && npm start
```

- The [e2e](./frontend/e2e) folder contains the UI testing via Cypress.
- All the UI code goes into [/frontend/src/app](./frontend/src/app).
- Take a look at the [/frontend/package.json](./frontend/package.json) scripts for more commands.

### Run Backend Only

- From the root directory, navigate to the [/backend](./backend) folder run `npm start` to start the API.

```bash
# From the root directory
cd ./backend && npm start
```

- All the API code goes into [/backend/apps/src/](./backend/apps/src/).
- Take a look at the [/backend/package.json](./backend/package.json) scripts for more commands.

### Run Flask API

> Note: Locally, the UI cannot access both the Flask and express API. You will need to change the port number in the .env file for the frontend to toggle between the two services.

- Run `flask.sh` from the root directory.

```bash
# From the root directory

./setup/flask.sh
```

- Cd into the `admin_server` folder.
- Run the flask app.

```bash
python3 main.py # development
gunicorn --workers 3 --bind localhost:5001 -m 007 wsgi:app # production (only tested on linux)
```
